@model IList<AdminUserModel>
@{
    ViewBag.Title = "系统设置";
    Layout = "~/Views/Shared/_ArtLayout.cshtml";
}
<script src="~/Scripts/jquery.validate.js"></script>
<script src="~/Scripts/Views/AdminUserList.js"></script>
<script src="~/Scripts/Extension/kendo.Extension.js"></script>
<script src="~/Scripts/webExpress/webExpress.controls.adpaters.js"></script>
<div class="conterbox systemSet">
    <h2 class="crumbs">您所在位置：系统设置
    </h2>
    <div class="managebox">
        <div class="searchbox clearfix">
            <span class="t-search">姓名<input id="txtUserName" type="text" value="" name="" class="searchinp" />
                <input type="button" id="btnSearch" value="搜索" name="" class="btn" /></span>
            <span class="t-addfl">
                <input type="submit" value="添加用户" name="" class="btn" id="J_adduser" /></span>
        </div>
        <div class="data">
            @Html.Partial("_List", Model)
        </div>
    </div>
</div>

<div class="systemSet">
    <!--添加用户提示 start-->
    <div class="add-openbox adduserbox" id="J_addUserBox">
        <h2>添加用户提示<a href="" class="J_closebox xbtn"></a></h2>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="adduser-bz">
            <tr>
                <td class="title-text"><i class="t-important">*</i>姓名:</td>
                <td class="title-inp">
                    <input id="txtName_Add" value="" name="" type="text" class="title-inp" /></td>
            </tr>
            <tr>
                <td class="title-text"><i class="t-important">*</i>登录名:</td>
                <td class="title-inp">
                    <input id="txtLoginName_Add" value="" name="" type="text" class="title-inp" /></td>
            </tr>
            <tr>
                <td class="title-text"><i class="t-important">*</i>登陆密码:</td>
                <td class="title-inp">
                    <input id="txtPassWord_Add" value="" name="" type="text" class="title-inp" /></td>
            </tr>
            <tr>
                <td class="title-text">职位:</td>
                <td class="title-inp">
                    <input id="txtPosition_Add" value="" name="" type="text" class="title-inp" /></td>
            </tr>
            <tr>
                <td class="title-text">联系方式:</td>
                <td class="title-inp">
                    <input id="txtContact_Add" value="" name="" type="text" class="title-inp" /></td>
            </tr>
        </table>
        <p class="btnbox">
            <input id="btnAdd" value="添加用户" type="button" class="J_closebox closebox" />

        </p>
    </div>
    <!--end-->
    <!--删除用户 start-->
    <div class="add-openbox" id="J_deleUserBox">
        <h2>删除提示<a href="" class="J_closebox xbtn"></a></h2>
        <p class="l-textinfo">
            确定删除该用户吗？删除后，该作品不可恢复。请谨慎操作！
        </p>
        <p class="btnbox">
            <input id="btnDelete" value="确定" type="button" class="J_closebox closebox" />
            <input value="取消" type="button" class="J_closebox closebox" />
        </p>
    </div>
    <!--end-->
    <!--查看用户 start-->
    <div class="add-openbox adduserbox" id="J_lookInfoBox">
        <h2>查看用户<a href="" class="J_closebox xbtn"></a></h2>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="adduser-bz">
            <tr>
                <td class="title-text">姓名:</td>
                <td id="tdUserName_look" class="title-inp">土豆</td>
            </tr>
            <tr>
                <td class="title-text">登录名:</td>
                <td id="tdLoginName_look" class="title-inp">得意的飘</td>
            </tr>
            <tr>
                <td class="title-text">职位:</td>
                <td id="tdPosition_look" class="title-inp">运营</td>
            </tr>
            <tr>
                <td class="title-text">联系方式:</td>
                <td id="tdContact_look" class="title-inp">123466789</td>
            </tr>
        </table>
        <p class="btnbox">
            <input value="确定" type="button" class="J_closebox closebox" />
            <input value="取消" type="button" class="J_closebox closebox" />
        </p>
    </div>
    <!--end-->
    <!--编辑用户提示 start-->
    <div class="add-openbox adduserbox" id="J_compileBox">
        <h2>编辑用户提示<a href="" class="J_closebox xbtn"></a></h2>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="adduser-bz">
            <tr>
                <td class="title-text"><i class="t-important">*</i>姓名:</td>
                <td class="title-inp">
                    <input id="txtName_edit" value="土豆" name="" type="text" class="title-inp" /></td>
            </tr>
            <tr>
                <td class="title-text"><i class="t-important">*</i>用户名:</td>
                <td class="title-inp">
                    <input id="txtLoginName_edit" value="得意的飘" name="" type="text" class="title-inp" /></td>
            </tr> 
            <tr>
                <td class="title-text">职位:</td>
                <td class="title-inp">
                    <input id="txtPosition_edit" value="运营" name="" type="text" class="title-inp" /></td>
            </tr>
            <tr>
                <td class="title-text">联系方式:</td>
                <td class="title-inp">
                    <input id="Contact_edit" value="138888888" name="" type="text" class="title-inp" /></td>
            </tr>
        </table>
        <p class="btnbox">
            <input id="btnEditAdminUser" value="确定" type="button" class="J_closebox closebox" />
            <input value="取消" type="button" class="J_closebox closebox" />
        </p>
    </div>
    <!--end-->
    <!--权限设置 start-->
    <div class="add-openbox adduserbox" id="J_qxsetBox">
        <h2>权限设置提示<a href="" class="J_closebox xbtn"></a></h2>
        <div class="ysjQxSet">
            <div>
                <h3 class="title J_downlist">艺术家管理 <span class="hover-up"></span></h3>
                <ul class="first-class J_showSetList">
                    <li class="firstli">
                        <input type="checkbox" value="" name="" />添加艺术家</li>
                    <li class="firstli">
                        <input type="checkbox" value="" name="" class="J_checkbtn" />艺术家管理</li>
                    <ul class="second-class">
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />编辑</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />删除</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />查看</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />发布</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />取消发布</li>
                    </ul>
                </ul>
            </div>
            <div>
                <h3 class="title J_downlist">作品管理 <span class="hover-up"></span></h3>
                <ul class="first-class J_showSetList">
                    <li class="firstli">
                        <input type="checkbox" value="" name="" />添加作品</li>
                    <li class="firstli">
                        <input type="checkbox" value="" name="" class="J_checkbtn" />作品管理</li>
                    <ul class="second-class">
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />编辑</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />删除</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />查看</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />发布</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />取消发布</li>
                    </ul>
                </ul>
            </div>
            <div>
                <h3 class="title J_downlist">权限管理 <span class="hover-up"></span></h3>
                <ul class="first-class J_showSetList">
                    <li class="firstli">
                        <input type="checkbox" value="" name="" />添加用户</li>
                    <li class="firstli">
                        <input type="checkbox" value="" name="" class="J_checkbtn" />用户管理</li>
                    <ul class="second-class">
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />编辑</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />删除</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />查看</li>
                        <li class="secondli">
                            <input type="checkbox" value="" name="J_checklist" />修改密码</li>
                    </ul>
                </ul>
            </div>

        </div>
        <p class="btnbox">
            <input value="确定" type="button" class="J_closebox closebox" />
            <input value="取消" type="button" class="J_closebox closebox" />
        </p>
    </div>
    <!--end-->
    <!--修改密码 start-->
    <div class="add-openbox adduserbox" id="J_xgPasswordBox">
        <h2>修改密码提示<a href="" class="J_closebox xbtn"></a></h2>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="adduser-bz">
            <tr>
                <td class="title-text">原密码:</td>
                <td class="title-inp">
                    <input value="" name="" type="password" class="title-inp" id="J_ypassword" /><span class="t-errormessage" id="txtypassworderror" style="display: none;">原密码错误</span></td>
            </tr>
            <tr>
                <td class="title-text">新密码:</td>
                <td class="title-inp">
                    <input id="J_newpassword" value="" name="" type="password" class="title-inp" /><span class="t-errormessage" id="txtnewpassworderror" style="display: none;"></span></td>
            </tr>
            <tr>
                <td class="title-text">确认密码:</td>
                <td class="title-inp">
                    <input id="J_conpassword" value="" name="" type="password" class="title-inp" /><span class="t-errormessage" id="txtconpassworderror" style="display: none;">两次密码输入不一致</span></td>
            </tr>

        </table>
        <p class="btnbox">
            <input id="btnConfirmUpPassword" value="确定" type="button" class="J_closebox closebox" />
            <input value="取消" type="button" class="J_closebox closebox" />
        </p>
    </div>
    <!--end-->
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var viewInstance = new art.ui.view.AdminUserList();
        viewInstance.init();
        var adminjs = new adminglass();//实例化后台js类
        var adminUserId;
        //关闭弹层
        $(document).on("click", ".J_closebox", function() {
            adminjs.closewinbox('.add-openbox');
            return false;
        });
        //添加用户
        $('#J_adduser').click(function () {
            adminjs.openwinbox('#J_addUserBox');
            return false;
        });
        //删除
        $(document).on("click", ".J_dele", function () {
            var tr = $(this).closest("tr");
            adminUserId = tr.attr("AdminUserId");
            adminjs.openwinbox('#J_deleUserBox');
            return false;
        });
        //查看用户
        $(document).on("click", ".J_lookInfo", function () {
            var tr = $(this).closest("tr");
            adminUserId = tr.attr("AdminUserId");
            $("#tdUserName_look").html(tr.attr("AdminUserName"));
            $("#tdLoginName_look").html(tr.attr("AdminUserLoginName"));
            $("#tdLoginPassWord_look").html(tr.attr("AdminUserPassWord"));
            $("#tdPosition_look").html(tr.attr("AdminUserPosition"));
            $("#tdContact_look").html(tr.attr("AdminUserContact"));
            adminjs.openwinbox('#J_lookInfoBox');
            return false;
        });

        //编辑用户
        $(document).on("click", ".J_compile", function () {
            var tr = $(this).closest("tr");
            adminUserId = tr.attr("AdminUserId");
            $("#txtName_edit").val(tr.attr("AdminUserName"));
            $("#txtLoginName_edit").val(tr.attr("AdminUserLoginName"));
            $("#txtPassWord_edit").val(tr.attr("AdminUserPassWord"));
            $("#txtPosition_edit").val(tr.attr("AdminUserPosition"));
            $("#Contact_edit").val(tr.attr("AdminUserContact"));
            adminjs.openwinbox('#J_compileBox');
            return false;
        });
        $("#btnConfirmUpPassword").click(function () {
            $("#txtconpassworderror").hide();
            $("#txtypassworderror").hide();
            $("#txtnewpassworderror").hide();
            var ypassword = $("#J_ypassword").val();
            var newpassword = $("#J_newpassword").val();
            var conpassword = $("#J_conpassword").val();
            if (ypassword == "") {
                $("#txtypassworderror").text("请输入原密码");
                $("#txtypassworderror").show();
                $("#J_ypassword").focus();
                return;
            }
            if (newpassword == "") {
                $("#txtnewpassworderror").text("新密码不能为空");
                $("#txtnewpassworderror").show();
                $("#J_newpassword").focus();
                return;
            }
            if (newpassword.length < 6) {
                $("#txtnewpassworderror").text("新密码不能小于6位");
                $("#txtnewpassworderror").show();
                $("#J_newpassword").focus();
                return;
            }
            if (conpassword != newpassword) {
                $("#txtconpassworderror").text("两次密码输入不一致");
                $("#txtconpassworderror").show();
                $("#J_conpassword").focus();
                return;
            }
            viewInstance.resetPassword({
                Id: adminUserId,
                Password: ypassword,
                NewPassword: newpassword
            });
            //alert(ymm + "  sssss");
            //if (ymm == false) {
            //    $("#txtypassworderror").show();
            //    $("#J_ypassword").focus();
            //    return;
            //}
        });
        $("#btnAdd").click(function () {
            var addModel = {
                Id: adminUserId,
                Name: $("#txtName_Add").val(),
                LoginName: $("#txtLoginName_Add").val(),
                PassWord: $("#txtPassWord_Add").val(),
                Position: $("#txtPosition_Add").val(),
                Contact: $("#Contact_Add").val()
            };
            viewInstance.addAdminUser(addModel);
        });
        //验证
        function chekAdminUserModel(model) {
            
        }
        $("#btnDelete").click(function () {
            viewInstance.deleteAdminUser(adminUserId);
        });
        $(document).on("click", "#btnEditAdminUser", function () {
            var editModel = {
                Id: adminUserId,
                Name: $("#txtName_edit").val(),
                LoginName: $("#txtLoginName_edit").val(),
                PassWord: $("#txtPassWord_edit").val(),
                Position: $("#txtPosition_edit").val(),
                Contact: $("#Contact_edit").val()
            };
            viewInstance.updateAdminUser(editModel);
        });
        //权限设置
        $(document).on("click", ".J_qxset", function() {
            adminjs.openwinbox('#J_qxsetBox');
            return false;
        });

            //修改密码
        $(document).on("click", ".J_xgPassword", function () {
            var tr = $(this).closest("tr");
            adminUserId = tr.attr("AdminUserId");
            adminjs.openwinbox('#J_xgPasswordBox');
            return false;

        });
        //权限设置下拉菜单
        adminjs.slidedownList('.J_downlist', '.J_showSetList');
        adminjs.clickCheck('.J_checkbtn', '.J_showSetList');



    })

</script>
